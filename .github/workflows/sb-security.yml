name: SB Security

on:
  push:
    branches: [main]
  pull_request:

jobs:
  gitleaks:
    name: gitleaks-required
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Install gitleaks
        env:
          GITLEAKS_VERSION: "8.30.0"
        run: |
          mkdir -p "$HOME/.local/bin"
          curl -sSfL \
            "https://github.com/gitleaks/gitleaks/releases/download/v${GITLEAKS_VERSION}/gitleaks_${GITLEAKS_VERSION}_linux_x64.tar.gz" \
            -o gitleaks.tar.gz
          tar -xzf gitleaks.tar.gz gitleaks
          install -m 0755 gitleaks "$HOME/.local/bin/gitleaks"
          echo "$HOME/.local/bin" >> "$GITHUB_PATH"
          "$HOME/.local/bin/gitleaks" version

      - name: Scan secrets
        run: gitleaks git --redact --no-banner --exit-code 1
